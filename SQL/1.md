# PostgreSQL 第１章

## データベースとは何か

大量のデータを保存し、コンピュータから利用しやすいように加工したデータの集まり。
データベースを管理するコンピュータシステムを*データベースマネジメントシステム(DBMS)*と呼ぶ。  

### DBMSが必要な理由
テキストファイルやExcelでもデータの保存はできるが、  
- 多人数でデータを共有するのに向かない  
- 大量のデータを扱える形式になってない  
- 読み書きを自動化するのにプログラミング技術が必要  
- 万一の事故に対応できない  

などのデメリットがある。DBMSはこれらすべてを解消できる。

### 主流のDBMS

#### リレーショナルデータベース(RDB)
列と行からなる２次元表の形式のデータベース、理解しやすい  
SQLという言語で操作する。  
他にもオブジェクトを保存したりxmlを保存したりするいろんな種類のデータベースがあるけどここでは割愛。  

## データベースの構成

クライアント/サーバ(C/S)型のシステム構成が基本。DBを利用するクライアント、DBを読み書きするサーバからなる。

２次元表のことを*テーブル*、そのデータ項目を表す列を*カラム*、１件のデータを表す行を*レコード*という。*SQL文にしたがって返されるデータは全てテーブルの形、テーブルの形にならないSQL文は実行できない*。  
行と列が交わる部分(セル)には１つのデータしか入らない。  

## SQLの概要

SQL：RDBMSを操作するための言語。*標準SQL*という標準規格があるが、RDBMSによって方言がある。
ここではPostgreSQLを使うが、標準SQL準拠で学習する。
SQL文では基本的にキーワードとテーブル名や列名を組み合わせて構成する、キーワードとなる命令は３種類  

- DDL(Data Definition Language)
  - データ定義言語、DBやテーブルの作成、削除などを行う
    - CREATE : DBやテーブルを作成
    - DROP : DBやテーブルを削除
    - ALTER : DBやテーブル構成の変更
- DML(Data Manipulation Language)
  - データ操作言語、テーブルの検索、変更などを行う
    - SELECT : テーブルから行を検索
    - INSERT : テーブルに新規行を登録
    - UPDATE : テーブルの行を更新
    - DELETE : テーブルの行を削除
- DCL(Data Control Language)
  - データ制御言語、DBに対して行った変更を確定したり、消したりする。他にはDBのユーザ権限の変更なども行う。  
    - COMMIT : DBに対して行った変更を確定
    - ROLLBACK : DBに対して行った変更を取り消す  
    - GRANT : ユーザに操作の権限を付与
    - REVOKE : ユーザから権限を剥奪

### SQL文の基本的なルール

- 最後に「;」を付ける
- 大文字、小文字は区別されない
  - キーワードやテーブル名、列名はどちらでも良い。けど基本的にキーワードは大文字、テーブル名や列名は小文字推奨  
    ただし、登録されているデータに関してはちゃんと区別される  
- 定数の書き方には決まりがある
  - じかに書く文字列や日時などの定数は*シングルクォーテーション*で囲う。e.g.) 'abc'  
- 単語は半角スペースか改行で区切る  

## テーブルの作成

### DBの作成
```CREATE DATABASE <DB名>```  
e.g)  ```CREATE DATABASE shop``` 

### テーブルの作成
~~~
CREATE TABLE <TABLE名>(
                      <列名1> <データ型> <この列の制約>,
                      <列名2> <データ型> <この列の制約>
                      .
                      .
                      .
                      );
~~~  

e.g.)  
~~~
CREATE TABLE Shohin(
                    shohin_id CHAR(4) NOT NULL,
                    shohin_mei VARCHAR(100) NOT NULL,
                    shohin_bunrui VARCHAR(32) NOT NULL,
                    hanbai_tanka INTEGER,
                    shiire_tanka INTEGER,
                    torokubi DATE,
                    PRIMARY KEY (shohin_id)
                    );
~~~

### 命名ルール

- DB、テーブル、列などの名前には
  - 半角アルファベット
  - 半角数字
  - アンダーバー（_）

- 名前の最初の文字は半角アルファベット
- 名前は重複してはいけない

### データ型

- INTEGER
  - 整数を入れる型、小数は入れられない
- CHAR
  - 文字列を入れるのに使う型、*CHAR(100)*のように入れることができる文字列の最大長を入れる。  
  *固定長文字列*で文字列が格納され、例えばCHAR(8)の列に'abc'を入れると、'abc     '(半角スペース５つ)で格納される。  
- VARCHAR
  - CHARと同じく文字列を扱うデータ型だが、*可変長文字列*で格納されるため、データはそのまま。
- DATE
  - 日付を入れるのに使うデータ型

CHAR型は社員番号や郵便番号などデータの桁数が決まっているもの、VARCHARは氏名や書籍名などデータの桁数が変動するものに指定する。  

### 制約の設定

制約: 列に入れるデータに制限や条件を追加する機能
上で指定した*NOT NULL(項目が無記入ではいけない)*など  
また、*PRIMARY KEY (shohin_id)*では、shohin_idに*主キー制約*を付与している。
主キー: １つの行を特定できる一意な値  


## テーブルの削除、変更

### テーブルの削除
```DROP TABLE <TABLE名>;```  
やり直しはできないので注意！  

### テーブル定義の変更

列を追加  

``` ALTER TABLE <TABLE名> ADD COLUMN <列の定義>;```  

列を削除  

```ALTER TABLE <TABLE名> DROP COLUMN <列名>;```  
